package ircnetservices

import (
	//"encoding/json"
	//"errors"
	"fmt"
	"log"
	//"math/rand"
	//"net/http"

	//"github.com/amfranz/go-xmlrpc-client"  	//forked from "github.com/nilshell/xmlrpc"
)

var (
	DEBUG = 1
	INFO  = 2
	WARN  = 3
	LogOutput chan string
	LogLevel int
)

func init() {
	LogOutput = make(chan string, 5)

	// Print any ircservicesgateway logout to STDOUT
	go printLogOutput()
}

func ConfigLog(loglevel int) {
        LogLevel = loglevel
	//log.Printf("LogLevel: %d", LogLevel)
	logOut(DEBUG, "LogLevel: %d", LogLevel)
	return
}

func logOut(level int, format string, args ...interface{}) {
	if level < LogLevel {
		return
	}

	levels := [...]string{"L_DEBUG", "L_INFO", "L_WARN"}
	line := fmt.Sprintf(levels[level-1]+" "+format, args...)

	select {
	case LogOutput <- line:
	}
}

func printLogOutput() {
	for {
		line, _ := <-LogOutput
		log.Println(line)
	}
}
